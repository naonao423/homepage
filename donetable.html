<!doctype html>
<html lang="ja">
  <head>
    <h5><br></h5>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="utils.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- 自作javascript -->
    <script type="text/javascript" src="done-table/somefunction.js"></script>
    <script src="done-table/eventer.js"></script>


    <nav class="navbar navbar-expand-md navbar-light bg-dark fixed-top">
    <a class="navbar-brand text-white" href="#">Homename</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="homepage.html">Home<span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="programing.html">Programming</a>
          <li class="nav-item">
            <a class="nav-link" href="Urls.html">Urls</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="donetable.html">Todos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="datas.html">Data</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="setting.html">Setting</a>
          </li>
        </ul>
      </div>
    </nav>
    <title id="top">Hello, world!</title>
<!-- registermodalの初期設定 -->

    <div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="registerModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="registerModalLabel">達成！</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="register-body"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal"　id="register-close">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- settingmodalの初期設定 -->

        <div class="modal fade" id="settingModal" tabindex="-1" role="dialog" aria-labelledby="settingModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="settingModalLabel">Setting Modal</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form>
                 <div class="form-group">
                   <label for="recipient-name" class="col-form-label">tablename</label>
                   <input type="text" class="form-control" id="setting-table-name">
                 </div>
               </form>
               <form>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">tags</label>
                  <input type="text" class="form-control" id="setting-table-tags">
                </div>
              <div id="exist-tags-setting"></div>
              </form>
               <p id="settingtest"></p>
               <button class="btn btn-danger delete-table" type="button" style="width:100%;" id="delete-table">delete table</button>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" >Close</button>
                <button type="button" class="btn btn-primary changedsetting" id="ChangedSetting-init">Save changes</button>
              </div>
            </div>
          </div>
        </div>


        <!-- createmodalの初期設定 -->

            <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="createModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form>
                     <div class="form-group">
                       <label for="recipient-name" class="col-form-label">tablename</label>
                       <input type="text" class="form-control" id="table-name">
                     </div>
                     <form>
                      <div class="form-group">
                        <label for="recipient-name" class="col-form-label">new tags<span style="font-size: 12px;">(if you want to set multiple tags, you can sepalate by ",")</span></label>
                        <input type="text" class="form-control" id="table-tags">
                      </div>
                    </form>
                    <div id="exist-tags"></div>
                     <div class="form-group">
                       <label for="message-text" class="col-form-label">table's length</label>
                       <input type="text" class="form-control" id="table-length" value=20></input>
                     </div>
                     <div class="form-group">
                       <label for="message-text" class="col-form-label">data par column</label>
                       <input type="text" class="form-control" id="table-column" value=10></input>
                     </div>
                   </form>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id='create-table'>Create Table</button>
                  </div>
                </div>
              </div>
            </div>


  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <nav id="sidebarmenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
          <div class="sidebar-sticky px-2">
            <ul class="nav flex-column px-2">
              <li>
                <table  class="table" id="time_color_list">
                <thead>
                  <th scope="col">times</th>
                  <th scope="col">color</th>
                </thead>
                  <tr>
                    <td>one</td>
                    <td id="one_time">gray</td>
                  </tr>
                  <tr>
                    <td>two</td>
                    <td id="second_time">green</td>
                  </tr>
                  <tr>
                    <td>three</td>
                    <td id="three_time">sky</td>
                  </tr>
                  <tr>
                    <td>four</td>
                    <td id="four_time">purple</td>
                  </tr>
                  <tr>
                    <td>five</td>
                    <td id="five_time">yellow</td>
                  </tr>
                  <tr>
                    <td>six</td>
                    <td id="six_time">orange</td>
                  </tr>
                  <tr>
                    <td>seven</td>
                    <td id="seven_time">red</td>
                  </tr>
                </table>
                <button type="button" id="jsontest">test</button>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>



  <main role="main" role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4 mt-5">
    <div id="main"></div>
    <div class="container" id="top">

        <div class="row">
          <div class="tab-content">
            <div class="tab-pane fade in active show" id="main_tablepart">
              <div id="main_tablepart"></div>

        <!--
        <div  class="col-12 t" id="tid-1">
          <h3 style="position: absolute; left: 10px; top: 10px">tabletitle</h3>
          <input type='button'  style="position: absolute; right: 10px; top: 10px" class='btn btn-primary' value="setting"/>
            <div style="font-size: 40px;"><br></div>
          <div  class="col-12 c">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <td align="center" style="background-color:red;">test1</td>
                  <td align="center">test2</td>
                  <td align="center">test3</td>
                </tr>
                <tr>
                  <td align="center">test1</td>
                  <td align="center">test2</td>
                  <td align="center">test3</td>
                </tr>
                <tr>
                  <td align="center">test1</td>
                  <td align="center">test2</td>
                  <td align="center">test3</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="container bottom" >
            <div class="row">
              <div  class="col-lg-2 col-sm-4 col-6">
                <input type='button' class='btn btn-primary' value="auto-generate"/>
              </div>
              <div  class="col-lg-8 col-sm-6 col-6">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="input done parameter" aria-label="Recipient's username" aria-describedby="basic-addon2" >
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button">Done!</button>
                  </div>
                </div>
              </div>
              <div  class="col-lg-2 col-sm-2 col-6">
                <p>達成率<span style="font-size:25px ">   test</span></p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 t" id="tid-2">
        </div>
        <div class="col-12 t">
          <p id="summary"></p>
        </div>
       -->
      </div>
    </div>
    </div>
    </div>
    <div class="col-12"></div>
    <button class="btn btn-outline-secondary" style="width: 100%" type="button" data-toggle="modal" data-target="#createModal">create table!</button>
  </main>


  <script>

  // ここで大枠のタイトルを取得
  var alldata = []
  var tidlist = []
  var lenlist = []
  var graphrow_list = []
  var tablename_list = []
  var rowdesplay_list = []
  var tag_list = []
  var tablelength = 0
  var base = ""
  var urls  = root_url1 + "donetable/"
  var taglist_unique = []
  var achivementratelist =[]
    $.ajax({
      'url':urls,
      'type':"GET",
    }).done(function(data){
      alldata = data
      table_load(data)
      taglist = get_tag(alldata)
      tab_creation(taglist_unique)
      console.log(taglist)
      show_the_achivement(alldata)
  }
);

// tabを作る部分 //////////////////////////////////////////
function tab_creation(taglist_unique){
console.log(taglist_unique)
tabbase = ""
tabbase += '<ul class="nav nav-pills nav-justified">' +
           '<li><a class="active nav-item nav-link" data-toggle="pill" href="#main_tablepart" id="tab-all">All</a></li>'
taglist_unique.forEach((item, i) => {
  tabbase += `<li><a class="nav-item nav-link" data-toggle="pill" href="#main_tablepart" id="tab-${item}">${item}</a></li>`
});
tabbase += "</ul>"
console.log(tabbase)
$('#main').append(tabbase)
}

// dataを保存する関数 ////////////////////////////////////////////////////////////
function table_load(data){
result = table_list(data);
console.log(tidlist)
console.log(lenlist)
console.log(graphrow_list)
console.log(tablename_list)
console.log(tablelength)
console.log(rowdesplay_list)
console.log(tag_list)
console.log(achivementratelist)
for (var i=1; i<=tablelength; i++){
  tag_text = ""
  tag_list[i-1].forEach((item, i) => {
    tag_text += "tag-"+ item + " "
  });
  appendpart = `<div class="col-12 t ${tag_text}" id="tid-${tidlist[i-1]}"></div>`;
  // console.log(appendpart)
  base += appendpart
}
$('#main_tablepart').append(base)
for (var i=0;  i<=tablelength-1; i++){
  trrow = Math.floor(lenlist[i]/graphrow_list[i])
  lastcolumns = lenlist[i]%graphrow_list[i]
  // tag_listの作成
  tag_text = ""
  tag_list[i].forEach((item, i) => {
    tag_text +="#" + item + " "
  });




  //追加する行のベース
  insertbase = ""
  // 最初の部分
  insertbase += `<h3 style="position: absolute; left: 10px; top: 10px">${tablename_list[i]}<span style="font-size:70%; color:rgba(116, 191, 255, 0.7);"> ${tag_text}</span></h3>` +
  `<button class="btn btn-outline-secondary"  style="position: absolute; right: 10px; top: 10px" type="button" id="register-${tidlist[i]}" data-toggle="modal" data-target="#settingModal">Setting</button>`+
  '<div style="font-size: 40px;"><br></div>'+
  `<div  class="col-12 c">`
  //tableの部分
  insertbase += '<table class="table table-bordered">'+'<tbody>'
  console.log(rowdesplay_list[i])
  if (Object.keys(rowdesplay_list[i]).includes("L")){
    console.log("test")
  for (var j=1; j<=trrow+1; j++){
    insertbase += '<tr>'
    if (j != trrow+1){
      for (var k=(j-1)*graphrow_list[i]+1; k<=j*graphrow_list[i]; k++){
        ks = rowdesplay_list[i]['L'][k-1]
        var segment_table = `<td class="td-${tidlist[i]}" align="center" id=segment-${tidlist[i]}-${k}>${ks}</td>`
        insertbase += segment_table
      }
    }
    else{
      for (var k=(j-1)*graphrow_list[i]+1; k<=lenlist[i]; k++){
        ks = rowdesplay_list[i]['L'][k-1]
        var segment_table = `<td  class="td-${tidlist[i]}" align="center" id=segment-${tidlist[i]}-${k}>${ks}</td>`
        insertbase += segment_table
      }
    }
    insertbase += '</tr>'
  }
  insertbase += '</tbody>'+'</table>'
  insertbase += '</div>'
  // console.log(insertbase)
  var gettid = `tid-${tidlist[i]}`
  // console.log("gettid",gettid)
  insertbase += '<div class="container bottom">'+
    '<div class="row">'+
      '<div  class="col-lg-2 col-sm-4 col-6">'+
        `<button type="button" class="btn btn-primary autogeness" id=autogene-${tidlist[i]}>auto-generate</button>`+
        '</div>'+
        '<div  class="col-lg-7 col-sm-8 col-6">'+
        '<div class="input-group">'+
        `<input type="text" class="form-control" placeholder="input done parameter" aria-label="Recipients username" aria-describedby="basic-addon2" id="inputdone-${tidlist[i]}">`+
          '<div class="input-group-append">'+
            `<button class="btn btn-outline-secondary" type="button" id="register-${tidlist[i]}" data-toggle="modal" data-target="#registerModal">Done!</button>`+
          '</div></div></div>'+
      '<div  class="col-lg-3 col-sm-6 col-6">'+
        `<p  class="achivement" id=achivementrate-${tidlist[i]}>達成率<span style="font-size:1em">${achivementratelist[i]}</span></p>`+
      '</div>'
  $('#'+gettid).append(insertbase)
}
else{
  for (var j=1; j<=trrow+1; j++){
    insertbase += '<tr>'
    if (j != trrow+1){
      for (var k=(j-1)*graphrow_list[i]+1; k<=j*graphrow_list[i]; k++){
        var segment_table = `<td class="td-${tidlist[i]}" align="center" id=segment-${tidlist[i]}-${k}>${k}</td>`
        insertbase += segment_table
      }
    }
    else{
      for (var k=(j-1)*graphrow_list[i]+1; k<=lenlist[i]; k++){
        var segment_table = `<td  class="td-${tidlist[i]}" align="center" id=segment-${tidlist[i]}-${k}>${k}</td>`
        insertbase += segment_table
      }
    }
    insertbase += '</tr>'
  }
  insertbase += '</tbody>'+'</table>'
  insertbase += '</div>'
  // console.log(insertbase)
  var gettid = `tid-${tidlist[i]}`
  // console.log("gettid",gettid)
  insertbase += '<div class="container bottom">'+
    '<div class="row">'+
      '<div  class="col-lg-2 col-sm-4 col-6">'+
        `<button type="button" class="btn btn-primary autogeness" id=autogene-${tidlist[i]}>auto-generate</button>`+
        '</div>'+
        '<div  class="col-lg-7 col-sm-8 col-6">'+
        '<div class="input-group">'+
        `<input type="text" class="form-control" placeholder="input done parameter" aria-label="Recipients username" aria-describedby="basic-addon2" id="inputdone-${tidlist[i]}">`+
          '<div class="input-group-append">'+
            `<button class="btn btn-outline-secondary" type="button" id="register-${tidlist[i]}" data-toggle="modal" data-target="#registerModal">Done!</button>`+
          '</div></div></div>'+
      '<div  class="col-lg-3 col-sm-6 col-6">'+
        `<p class="achivement" id=achivementrate-${tidlist[i]}>達成率<span style="font-size:1em ">${achivementratelist[i]}</span></p>`+
      '</div>'
  $('#'+gettid).append(insertbase)
}
  insertbase =''
}
}


////////////////////////////////////////////////////////////////////////////////

// event軸
　//　register部分
  $('#registerModal').on('show.bs.modal',function(event){
    var button = $(event.relatedTarget)
    var tid = button.attr('id')
    // console.log(tid)
    var tid_number = tid.split('-')[1]
    // console.log(tid_number)
    var inputdone = `inputdone-${tid_number}`
    var done_number = $("#"+inputdone).val()
    // console.log(typeof done_number)
    done_number1 = Number(done_number)
    // console.log(isNaN(done_number1))
    var selected_data = tid_get(tid_number,alldata)
    // console.log(selected_data)
    if (!isNaN(done_number1) && done_number1 != 0){
    // console.log(done_number1)
    urlss = root_url1 +`donetable/recoad/${tid_number}/${done_number1}`
    $.ajax({
      "url":urlss,
      "type" :"PUT"
    }).done()
    inputdata = tid_get(tid_number,alldata)
    console.log('done')
    // モーダルに値を入力
    var modal = $(this)
    modal.find('#register-body').text(inputdata['table_name']+"の"+done_number+"を達成しました。")
  }
  else if(selected_data['row_desplay']['L'].includes(done_number)){
    selected_data['row_desplay']['L'].forEach((item, i) => {
      if (item==done_number){
        done_number1 = i+1
      }
    });
    console.log(done_number1)
    urlss = root_url1 +`donetable/recoad/${tid_number}/${done_number1}`
    $.ajax({
      "url":urlss,
      "type" :"PUT"
    }).done()
    inputdata = tid_get(tid_number,alldata)
    console.log('done')
    // モーダルに値を入力
    var modal = $(this)
    modal.find('#register-body').text(inputdata['table_name']+"の"+done_number+"を達成しました。")
  }
  else{
      var modal = $(this)
      modal.find('#register-body').text("値が正しく入力されていません")
    }
  });


  $('#registerModal').on('hidden.bs.modal',function(event){
    console.log("test")
      window.location.reload()
  });




  $('#main_tablepart').on('click','.autogeness',function(event){
    var button = $(event.target)
    var tid = button.attr('id')
    console.log(tid)
    var tid_number = tid.split('-')[1]
    console.log(tid_number)
    var done_number = ramdom_from_done(String(tid_number),alldata)

    select_id_input = `inputdone-${tid_number}`
    $('#'+select_id_input).val(done_number)

  });

  $("#createModal").on("show.bs.modal",function(event){
    var insertbase = ""
    insertbase += "<ul>"
    $("#exist-tags").empty()
    console.log(taglist_unique)
    taglist_unique.forEach((item, i) => {
      console.log(item)
      insertbase += "<li>" +
                    `<input type="checkbox" id=tag-${item} name="create-tags" value="${item}">` +
                    `<label for="tag-${item}">${item}</label>` +
                    "</li>"
    });
    insertbase += "</ul>"
    console.log(insertbase)
    $("#exist-tags").append(insertbase)
  })

  $("#create-table").on("click",function(event){
      var table_name =  $("#table-name").val()
      var table_length = $("#table-length").val()
      var table_column =  $("#table-column").val()
      var input_data ={}

      var _tag = []; // 配列を定義
      $('input[name="create-tags"]:checked').each(function() {
        _tag.push( $(this).val() ); // 配列に値を追加
      });
      var tag = $("#table-tags").val()
      console.log(tag)
      if (tag == ""){
        console.log("pass")
      }
      else if (tag.includes(",")){
        console.log(",があります")
        var tag = tag.split(',')
        tag.forEach((item, i) => {
          _tag.push(item)
        });
      }
      else{
        console.log(",がありません")
        _tag.push(tag)
      }
      input_data['tags'] = _tag

      var urls1 = root_url1 + `donetable/create/${table_name}/${table_length}/${table_column}`
      $.ajax({
        "url":urls1,
        "type":"POST",
        "contentType":"application/json",
        "data":JSON.stringify(input_data)
      }).done(
        // window.location.reload()
      )
  })

//  setting modal の部分
  $('#settingModal').on('show.bs.modal',function(event){
    $('#settingtest').empty()
    $('#exist-tags-setting').empty()
    var button = $(event.relatedTarget)
    var tid = button.attr('id')
    console.log(tid)
    var tid_number = tid.split('-')[1]
    console.log(tid_number)
    console.log(alldata[0])
    $('#settingtest').empty()
    var selected_data = setting_table(alldata,tid_number)
    console.log(selected_data)
    insertbase = ""
    trrow = Math.floor(selected_data['len']/selected_data['graphrow'])
    lastcolumns = selected_data['len']%selected_data['graphrow']
    // console.log(trrow,lastcolumns)
    //追加する行のベース
    insertbase = ""
    // 最初の部分
    insertbase += "<p id='setting-table-name-label'> table name setting</p>"
    insertbase += '<table class="table table-bordered">'+'<tbody>'
    for (var j=1; j<=trrow+1; j++){
      insertbase += '<tr>'
      if (j != trrow+1){
        for (var k=(j-1)*selected_data['graphrow']+1; k<=j*selected_data['graphrow']; k++){
          var setting_index = `segment-${tid_number}-${k}`

          kss = $("#"+setting_index).text()
          console.log(kss)
          var segment_table = `<td class="td-${selected_data['tid']}" align="center" id=setting-segment-${selected_data['tid']}-${k}>`+
          `<input type="text" style="width:40px" id=setting-input-${tid_number}-${k} value="${kss}" />`+"</td>"
          insertbase += segment_table
        }
      }
      else{
        for (var k=(j-1)*selected_data['graphrow']+1; k<=selected_data['len']; k++){
          var setting_index = `segment-${tid_number}-${k}`
          kss = $("#"+setting_index).text()
          var segment_table = `<td  class="td-${selected_data['tid']}" align="center" id=setting-segment-${selected_data['tid']}-${k}>`+
          `<input type="text" style="width:40px" id=setting-input-${tid_number}-${k} value="${kss}"/>`+"</td>"
          insertbase += segment_table
        }
      }
      insertbase += '</tr>'
    }
    insertbase += '</tbody>'+'</table>'
    $('#settingtest').append(insertbase)
    insertbase = ""
    $('.delete-table').attr("id",`delete-table-${tid_number}`)

    // tagの設定
    taglist_unique.forEach((item, i) => {
      console.log(item)
      insertbase += "<li>" +
                    `<input type="checkbox" id=tag-${item} name="create-tags" value="${item}">` +
                    `<label for="tag-${item}">${item}</label>` +
                    "</li>"
    });
    insertbase += "</ul>"
    console.log(insertbase)
    $("#exist-tags-setting").append(insertbase)
    check_exist(alldata,tid_number)
  });

  $('#settingModal').on('shown.bs.modal',function(event){

    var button = $(event.relatedTarget)
    var tid = button.attr('id')
    var tid_number = tid.split('-')[1]
    console.log("modal shown!!")
    $('#settingModal').find('.changedsetting').attr('id',`ChangedSetting-${tid_number}`)
  })

  $(".changedsetting").on("click",function(event){
    file_to_send_backend = {}
    var button = $(event.target)
    var tid = button.attr('id')
    console.log(tid)
    var tid_number = tid.split('-')[1]
    console.log(tid_number)
    console.log(alldata[0])
    var selected_data = setting_table(alldata,tid_number)
    var table_length = selected_data['len']
    output_data = []
    for (var i=1; i<=table_length; i++){
      index_name = `setting-input-${tid_number}-${i}`
      console.log(index_name)
      index_value = $("#"+index_name).val()
      output_data.push(index_value)
    }
    console.log(output_data)
    const unique_output_data = Array.from(new Set(output_data))
    console.log(unique_output_data)
    console.log(output_data)
    if (output_data.length != unique_output_data.length){
      $("#setting-table-name-label").append(" <p style='color:red; id='unique_error'>同じ値があります</p>")
    }
    else{

      var _tag = []; // 配列を定義
      $('input[name="create-tags"]:checked').each(function() {
        _tag.push( $(this).val() ); // 配列に値を追加
      });
      var tag = $("#setting-table-tags").val()
      if (tag == ""){

      }
      else if (tag.includes(",")){
        console.log(",があります")
        var tag = tag.split(',')
        tag.forEach((item, i) => {
          _tag.push(item)
        });
      }
      else{
        console.log(",がありません")
        _tag.push(tag)
      }
//  バックエンドに送るファイルの整理
      $('#unique_error').empty()
    file_to_send_backend['rowdesplay'] = output_data
    file_to_send_backend['tags'] = _tag
    output_name = $("setting-table-name").val()
    if (output_name == undefined){
      output_name = ""
    }
    file_to_send_backend['name'] =output_name
    console.log(file_to_send_backend)

    urls = root_url1 + `donetable/changesetting/${tid_number}`
    $.ajax({
      "url":urls,
      "type":"PUT",
      'contentType':'application/json',
      'data': JSON.stringify(file_to_send_backend),
    }).done(function(data){
      console.log(data)
      window.location.reload()
    }
  )
}
  })

var delete_sign = 0
  $('.delete-table').on("click",function(event){
    var button = $(event.target)
    var tid = button.attr('id')
    console.log(tid)
    var tid_number = tid.split('-')[2]
    console.log(tid_number)
    if (delete_sign == 0){
      $('.delete-table').append("<br>本当に消していいですか？<br>(いいならもう一度クリックしてください)")
      delete_sign = 1
    }
    else
    {
      urls = root_url1 +  `donetable/delete/${tid_number}`
      $.ajax({
        "url":urls,
        "type":'DELETE',
    }).done(window.location.reload())
  }})

  $('#main').on("click",".nav-item",function(event){

    var button = $(event.target)
    var tid = button.attr('id')
    console.log(tid)
    var tab_name = tid.split("-")[1]
    if (tab_name == "all"){
      setTimeout(function(){
        $(".t").css("display","block")
    }, 150)
    }
    else{
    tab_name = "tag-" + tab_name
    console.log(tab_name)
    setTimeout(function(){
      $(".t").css("display","block")
      $(".t").not("."+tab_name).css("display","none")
  }, 150)
}
  })



  </script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  </body>
</html>
