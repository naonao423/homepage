<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- js files -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="utils.js"></script>
  <title>Document</title>
</head>
<body>
  <button id="test">lists取り出しtest</button>
  <br>
  <br>
  <p id="json_result"></p>
  <p id="json_result1"></p>
  <input type="date" id="input_data_start" value="2020-08-20">
  <br>
  <input type="date" id="input_data_stop" value="2020-09-06">
  <br>
  <button id="test1">時間内のsummaryを取り出すtest</button>
  <br>
  <p id="summary"></p>
  <br>
  <button id="input_data_identification">時間テキストの取り出し</button>
  <p id="dateresult"></p>
  <br>
  <button id="reload">eventsの更新</button>
  <p id="result_reload"></p>
	<div class="content">
		<div class="wrapper" style="max-width: 512px; margin: auto">
			<canvas id="chart-0"></canvas>
		</div>
	</div>


  <script>
  var presets = window.chartColors;
  var utils = Samples.utils;
  var datas = [10,10,10,10,10,10,10,10,10,10]
  var inputs = {
    min: 8,
    max: 16,
    count: 10,
    decimals: 2,
    continuity: 1
  };

  utils.srand(42);

  var radardata = {
    labels: ["test","Programing","English","Study","Mediation","Streach","英単語","Reading"],
    datasets: [{
      backgroundColor:utils.transparentize(presets.red),
      borderColor: presets.red,
      data: datas,
      label: '一週間のデータ'
    }]
  };

  var options = {
    maintainAspectRatio: true,
    spanGaps: false,
    elements: {
      line: {
        tension: 0.1
      }
    },
    plugins: {
      filler: {
        propagate: false
      },
      'samples-filler-analyser': {
        target: 'chart-analyser'
      }
    }
  };

  var chart = new Chart('chart-0', {
    type: 'radar',
    data: radardata,
    options: options
  });





  document.getElementById('input_data_identification').addEventListener('click',
  function(){
    var start =document.querySelector('#input_data_start')
    var start_date = start.value
    var stop =document.querySelector('#input_data_stop')
    var stop_date = stop.value
    document.getElementById("dateresult").innerHTML = start_date + "<br>" + stop_date
  }
);


  document.getElementById('test1').addEventListener('click',
  function(){
    var start =document.querySelector('#input_data_start')
    var start_date = start.value
    var stop =document.querySelector('#input_data_stop')
    var stop_date = stop.value
    var urls = "http://127.0.0.1:8000/events/summary/" + start_date + "/" +stop_date
    var dic = ""
    var data_value = []
    $.ajax({
      'url':urls,
      'type':"GET",
    }).done(function(data){
      console.log(Object.keys(data))
      sublist = Object.keys(data)
      sublist.forEach(function(sub){
        console.log(sub);
        console.log(data[sub]);
        time = data[sub].hour * 60 + data[sub].minute + data[sub].second / 60;
        data_value.push(time);
      })
      document.getElementById("summary").innerHTML = data_value;
      console.log(radardata.datasets[0].data);
      radardata.datasets[0].data = data_value;
      chart.update();
      }
    ).fail(
      document.getElementById("summary").innerHTML = "ロード中"
    )});

  document.getElementById('reload').addEventListener('click',
  function(){
    var urls = "http://127.0.0.1:8000/events/reload"
    $.ajax({
      'url':urls,
      'type':"POST",
    }).done(function(data){
      document.getElementById("summary").innerHTML = data
    }).fail(
      document.getElementById("summary").innerHTML = "ロード中"
    )
  });





  document.getElementById('test').addEventListener('click',
  function(){
    var start =document.querySelector('#input_data_start')
    var start_date = start.value
    var stop =document.querySelector('#input_data_stop')
    var stop_date = stop.value
    var urls = "http://127.0.0.1:8000/events/lists"
    $.ajax({
      'url':urls,
      'type':"GET",
    }
  ).done(function(data){
    var suball = ""
    var durationall = ""
      data.forEach(function(part){
        var sub = part.sub;
        var duration = part.duration
        suball += sub + "<br>";
        durationall += duration +"<br>"
      })
      document.getElementById("json_result").innerHTML = suball
      document.getElementById("json_result1").innerHTML = durationall
    }
  ).fail(document.getElementById("json_result").innerHTML = "ロード中"
  )
});
  </script>

</body>

</html>
